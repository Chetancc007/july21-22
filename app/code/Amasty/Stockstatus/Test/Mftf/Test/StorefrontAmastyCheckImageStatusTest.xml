<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * @author Amasty Team
 * @copyright Copyright (c) 2020 Amasty (https://www.amasty.com)
 * @package Amasty_Stockstatus
 */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="StorefrontAmastyCheckStockStatusImageWithoutTextTest" extends="AdminAmastyCreateStockStatusOptionTest">
        <annotations>
            <title value="Create a custom stock status option with an image."/>
            <description value="Set module's configuration and attributes. Upload image for option. Check displaying."/>
            <testCaseId value="CSS-4"/>
            <severity value="CRITICAL"/>
            <group value="Stockstatus"/>
        </annotations>
        <before>
            <createData entity="SimpleProductA1" stepKey="createSimpleProductA1"/>
        </before>
        <after>
            <magentoCLI command="config:set amstockstatus/general/icon_only 0" stepKey="configDisplayImageOnly2"/>
            <deleteData stepKey="deleteSimpleProductA1" createDataKey="createSimpleProductA1"/>
        </after>

        <actionGroup ref="OpenProductAttributeFromSearchResultInGridActionGroup" stepKey="openProductAttribute2">
            <argument name="productAttributeCode" value="custom_stock_status"/>
        </actionGroup>
        <actionGroup ref="AdminAmastyAddStockStatusImageActionGroup" stepKey="goToAddImage">
            <argument name="am_test_option" value="amastyFirstOption"/>
        </actionGroup>
        <actionGroup ref="ClickSaveButtonActionGroup" stepKey="clickSaveAttributeAfterAddImage">
            <argument name="message" value="You saved the product attribute."/>
        </actionGroup>
        <magentoCLI command="cache:clean" stepKey="cacheClean"/>
        <magentoCLI command="config:set amstockstatus/general/icon_only 1" stepKey="configDisplayImageOnly"/>
        <magentoCLI command="config:set amstockstatus/display/display_on_category 1" stepKey="configDisplayStatusOnCategory"/>
        <magentoCLI command="config:set amstockstatus/display/display_in_cart 1" stepKey="configDisplayStatusInCart"/>
        <amOnPage url="{{AdminProductEditPage.url($createSimpleProductA1.id$)}}" stepKey="goToEditSimpleProductA1"/>
        <waitForAjaxLoad stepKey="waitForAjaxLoadProductA1EditPage"/>
        <actionGroup ref="AdminAmastyAssignStockStatusActionGroup" stepKey="setStockStatusToCreatedProduct">
            <argument name="am_test_option" value="amastyFirstOption"/>
        </actionGroup>
        <actionGroup ref="saveProductForm" stepKey="saveProduct"/>
        <actionGroup ref="OpenStoreFrontProductPageActionGroup" stepKey="goToTheProductA1">
            <argument name="productUrlKey" value="$createSimpleProductA1.custom_attributes[url_key]$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAmastyCheckStockStatusOnlyImageActionGroup" stepKey="verifyStockStatus">
            <argument name="am_test_option" value="amastyFirstOption"/>
        </actionGroup>
        <actionGroup ref="StorefrontAddToTheCartActionGroup" stepKey="addTheProductToTheCart"/>
        <actionGroup ref="StorefrontCheckQuickSearchActionGroup" stepKey="searchForProduct">
            <argument name="phrase" value="$createSimpleProductA1.name$"/>
        </actionGroup>
        <actionGroup ref="StorefrontAmastyCheckStockStatusOnlyImageActionGroup" stepKey="verifyStockStatusOnSearchPage">
            <argument name="am_test_option" value="amastyFirstOption"/>
        </actionGroup>
        <!-- check the cart -->
        <amOnPage url="/checkout/cart/" stepKey="amOnShoppingCartPage"/>
        <actionGroup ref="StorefrontAmastyCheckStockStatusOnlyImageActionGroup" stepKey="verifyStockStatusInCart">
            <argument name="am_test_option" value="amastyFirstOption"/>
        </actionGroup>
    </test>
</tests>
